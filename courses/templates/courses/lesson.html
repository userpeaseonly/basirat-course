{% extends "base.html" %}
{% load i18n %}
{% block title %}{{ lesson.title }} — {{ course.title }}{% endblock %}
{% block content %}
<div class="container mx-auto py-10">
    <div class="bg-white rounded-3xl shadow-xl border border-slate-100 p-8 space-y-6">
        <div class="flex flex-col gap-2">
            <a href="{% url 'course_detail' course.slug %}" class="text-sm text-slate-500 font-semibold">← {% trans "Back to course" %}</a>
            <h1 class="text-3xl font-bold text-slate-900">{{ lesson.title }}</h1>
            <p class="text-sm text-slate-500">{% trans "Lesson" %} {{ lesson.order|add:1 }} • {{ lesson.description|default:_('No description yet.') }}</p>
        </div>
        <div class="space-y-5">
            {% for material in materials %}
                <article class="border rounded-2xl p-4 bg-slate-50">
                    <div class="flex flex-wrap items-center justify-between gap-3">
                        <div>
                            <h2 class="text-xl font-semibold text-slate-900">{{ material.title }}</h2>
                            <p class="text-sm text-slate-500">{% if material.material_type == material.LEARNING %}{% trans "Learning resource" %}{% else %}{% trans "Task" %}{% endif %}</p>
                        </div>
                        {% if material.id in completed_ids %}
                            <span class="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs font-semibold">{% trans "Completed" %}</span>
                        {% endif %}
                    </div>
                    <div class="mt-3 text-slate-700 space-y-3 text-sm select-none" oncontextmenu="return false;">
                        {% if material.content %}
                            <p class="whitespace-pre-line">{{ material.content }}</p>
                        {% endif %}
                        {% if material.media_file %}
                            <div class="rounded-2xl bg-black/80 p-2">
                                <video
                                    controls
                                    playsinline
                                    disablepictureinpicture
                                    disableRemotePlayback
                                    controlsList="nodownload nofullscreen noremoteplayback"
                                    oncontextmenu="return false;"
                                    class="w-full rounded-xl bg-black"
                                >
                                    <source src="{{ material.media_file.url }}">
                                    {% trans "Your browser does not support inline video playback." %}
                                </video>
                            </div>
                        {% endif %}
                    </div>
                    {% if material.is_protected %}
                        <p class="text-xs text-slate-500 mt-4">{% trans "Downloads and copy-pastes are disabled for protected materials." %}</p>
                    {% endif %}
                    {% if material.id not in completed_ids %}
                        <form method="post" action="{% url 'material_complete' material.id %}" class="mt-3">
                            {% csrf_token %}
                            <button type="submit" class="px-4 py-2 text-sm rounded-full bg-blue-600 text-white font-semibold hover:bg-blue-700 transition">{% trans "Mark as completed" %}</button>
                        </form>
                    {% endif %}
                </article>
            {% empty %}
                <p class="text-sm text-slate-500">{% trans "No materials have been added yet." %}</p>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
